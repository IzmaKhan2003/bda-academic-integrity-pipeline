<!DOCTYPE html>
<html>
<head>
    <title>Academic Integrity Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f5f5;
}
.header {
    background: #1a73e8;
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}
.kpi-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.kpi-value {
    font-size: 36px;
    font-weight: bold;
    color: #1a73e8;
}
.kpi-label {
    color: #666;
    margin-top: 5px;
}
.chart-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}
.refresh-indicator {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #4caf50;
    color: white;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 14px;
}
</style>
</head>
<body>
<div class="refresh-indicator" id="refreshStatus">‚óè Live (updates every 60s)</div>

<div class="header">
    <h1>üìä Academic Integrity Monitoring Dashboard</h1>
    <p>Real-time analytics and detection</p>
</div>

<div class="kpi-grid">
    <div class="kpi-card">
        <div class="kpi-value" id="avgResponseTime">--</div>
        <div class="kpi-label">Avg Response Time (seconds)</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-value" id="highRiskCount">--</div>
        <div class="kpi-label">High-Risk Students</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-value" id="totalEvents">--</div>
        <div class="kpi-label">Total Events Processed</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-value" id="lastUpdate">--</div>
        <div class="kpi-label">Last Updated</div>
    </div>
</div>

<div class="chart-container">
    <h2>AI Usage Trend (Last 2 Hours)</h2>
    <canvas id="trendChart"></canvas>
</div>

<script>
let trendChart = null;

async function fetchKPIs() {
    const response = await fetch('/api/kpis');
    const data = await response.json();
    
    document.getElementById('avgResponseTime').textContent = 
        data.avg_response_time?.value?.toFixed(2) || '--';
    document.getElementById('highRiskCount').textContent = 
        data.high_risk_count?.value || '--';
    document.getElementById('totalEvents').textContent = 
        data.total_events?.value?.toLocaleString() || '--';
    document.getElementById('lastUpdate').textContent = 
        new Date().toLocaleTimeString();
}

async function fetchTrend() {
    const response = await fetch('/api/trend');
    const data = await response.json();
    
    const labels = data.trend.map(d => new Date(d.timestamp).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'}));
    const values = data.trend.map(d => d.avg_ai_score);
    
    if (trendChart) trendChart.destroy();
    
    const ctx = document.getElementById('trendChart').getContext('2d');
    trendChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Average AI Usage Score',
                data: values,
                borderColor: '#1a73e8',
                backgroundColor: 'rgba(26, 115, 232, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true, max: 1.0 }
            }
        }
    });
}

function refreshData() {
    fetchKPIs();
    fetchTrend();
    
    const indicator = document.getElementById('refreshStatus');
    indicator.style.background = '#ff9800';
    setTimeout(() => indicator.style.background = '#4caf50', 500);
}

// Initial load
refreshData();

// Auto-refresh every 60 seconds
setInterval(refreshData, 60000);
</script>
</body>
</html>
